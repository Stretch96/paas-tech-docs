<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>Route Services - Platform as a Service</title>

    <link href="/stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://docs.cloud.service.gov.uk/deploying_services/route_services/">

      <meta name="twitter:card" content="summary" />
      <meta name="twitter:domain" content="docs.cloud.service.gov.uk" />
      <meta name="twitter:image" content="https://docs.cloud.service.gov.uk/images/govuk-large.png" />
      <meta name="twitter:title" content="Route Services - Platform as a Service" />
      <meta name="twitter:url" content="https://docs.cloud.service.gov.uk/deploying_services/route_services/" />

      <meta property="og:image" content="https://docs.cloud.service.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="Platform as a Service" />
      <meta property="og:title" content="Route Services" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://docs.cloud.service.gov.uk/deploying_services/route_services/" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="https://www.cloud.service.gov.uk" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__logotype">
          <svg
            aria-hidden="true"
            focusable="false"
            class="govuk-header__logotype-crown"
            xmlns="http://www.w3.org/2000/svg"
            viewbox="0 0 132 97"
            height="30"
            width="36"
          >
            <path
              fill="currentColor" fill-rule="evenodd"
              d="M25 30.2c3.5 1.5 7.7-.2 9.1-3.7 1.5-3.6-.2-7.8-3.9-9.2-3.6-1.4-7.6.3-9.1 3.9-1.4 3.5.3 7.5 3.9 9zM9 39.5c3.6 1.5 7.8-.2 9.2-3.7 1.5-3.6-.2-7.8-3.9-9.1-3.6-1.5-7.6.2-9.1 3.8-1.4 3.5.3 7.5 3.8 9zM4.4 57.2c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.5-1.5-7.6.3-9.1 3.8-1.4 3.5.3 7.6 3.9 9.1zm38.3-21.4c3.5 1.5 7.7-.2 9.1-3.8 1.5-3.6-.2-7.7-3.9-9.1-3.6-1.5-7.6.3-9.1 3.8-1.3 3.6.4 7.7 3.9 9.1zm64.4-5.6c-3.6 1.5-7.8-.2-9.1-3.7-1.5-3.6.2-7.8 3.8-9.2 3.6-1.4 7.7.3 9.2 3.9 1.3 3.5-.4 7.5-3.9 9zm15.9 9.3c-3.6 1.5-7.7-.2-9.1-3.7-1.5-3.6.2-7.8 3.7-9.1 3.6-1.5 7.7.2 9.2 3.8 1.5 3.5-.3 7.5-3.8 9zm4.7 17.7c-3.6 1.5-7.8-.2-9.2-3.8-1.5-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.3 3.5-.4 7.6-3.9 9.1zM89.3 35.8c-3.6 1.5-7.8-.2-9.2-3.8-1.4-3.6.2-7.7 3.9-9.1 3.6-1.5 7.7.3 9.2 3.8 1.4 3.6-.3 7.7-3.9 9.1zM69.7 17.7l8.9 4.7V9.3l-8.9 2.8c-.2-.3-.5-.6-.9-.9L72.4 0H59.6l3.5 11.2c-.3.3-.6.5-.9.9l-8.8-2.8v13.1l8.8-4.7c.3.3.6.7.9.9l-5 15.4v.1c-.2.8-.4 1.6-.4 2.4 0 4.1 3.1 7.5 7 8.1h.2c.3 0 .7.1 1 .1.4 0 .7 0 1-.1h.2c4-.6 7.1-4.1 7.1-8.1 0-.8-.1-1.7-.4-2.4V34l-5.1-15.4c.4-.2.7-.6 1-.9zM66 92.8c16.9 0 32.8 1.1 47.1 3.2 4-16.9 8.9-26.7 14-33.5l-9.6-3.4c1 4.9 1.1 7.2 0 10.2-1.5-1.4-3-4.3-4.2-8.7L108.6 76c2.8-2 5-3.2 7.5-3.3-4.4 9.4-10 11.9-13.6 11.2-4.3-.8-6.3-4.6-5.6-7.9 1-4.7 5.7-5.9 8-.5 4.3-8.7-3-11.4-7.6-8.8 7.1-7.2 7.9-13.5 2.1-21.1-8 6.1-8.1 12.3-4.5 20.8-4.7-5.4-12.1-2.5-9.5 6.2 3.4-5.2 7.9-2 7.2 3.1-.6 4.3-6.4 7.8-13.5 7.2-10.3-.9-10.9-8-11.2-13.8 2.5-.5 7.1 1.8 11 7.3L80.2 60c-4.1 4.4-8 5.3-12.3 5.4 1.4-4.4 8-11.6 8-11.6H55.5s6.4 7.2 7.9 11.6c-4.2-.1-8-1-12.3-5.4l1.4 16.4c3.9-5.5 8.5-7.7 10.9-7.3-.3 5.8-.9 12.8-11.1 13.8-7.2.6-12.9-2.9-13.5-7.2-.7-5 3.8-8.3 7.1-3.1 2.7-8.7-4.6-11.6-9.4-6.2 3.7-8.5 3.6-14.7-4.6-20.8-5.8 7.6-5 13.9 2.2 21.1-4.7-2.6-11.9.1-7.7 8.8 2.3-5.5 7.1-4.2 8.1.5.7 3.3-1.3 7.1-5.7 7.9-3.5.7-9-1.8-13.5-11.2 2.5.1 4.7 1.3 7.5 3.3l-4.7-15.4c-1.2 4.4-2.7 7.2-4.3 8.7-1.1-3-.9-5.3 0-10.2l-9.5 3.4c5 6.9 9.9 16.7 14 33.5 14.8-2.1 30.8-3.2 47.7-3.2z"
            ></path>
            <image src="/assets/images/govuk-logotype-crown.png" xlink:href="" class="govuk-header__logotype-crown-fallback-image" width="36" height="32"></image>
          </svg>
          <span class="govuk-header__logotype-text">
            GOV.UK
          </span>
        </span>
        <span class="govuk-header__product-name">
          Platform as a Service
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide Top Level Navigation">Menu</button>
      <nav>
        <ul id="navigation" class="govuk-header__navigation govuk-header__navigation--end" aria-label="Top Level Navigation">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="https://www.cloud.service.gov.uk">About</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="https://www.cloud.service.gov.uk/get-started">Get started</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="https://www.cloud.service.gov.uk/features">Features</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="https://github.com/alphagov/paas-roadmap/projects/1">Roadmap</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/">Documentation</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="https://admin.london.cloud.service.gov.uk/support">Support</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <button type="button" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </button>
        </div>

      <div class="app-pane__body" data-module="in-page-navigation">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents" tabindex="-1" aria-label="Table of contents">
              <div class="search" data-module="search">
  <form action="https://www.google.co.uk/search" method="get" role="search">
    <input type="hidden" name="as_sitesearch" value="https://docs.cloud.service.gov.uk"/>
    <label class="govuk-label search__label" for="search">
      Search (via Google)
    </label>
    <input class="govuk-input govuk-!-margin-bottom-4" id="search" name="q" type="text" aria-controls="search-results" placeholder="Search">
  </form>
  <div id="search-results" class="search-results" aria-hidden="true" role="dialog" aria-labelledby="search-results-title">
    <div class="search-results__inner">
      <button class="search-results__close">Close<span class="search-results__close-label"> search results</span></button>
      <h2 id="search-results-title" class="search-results__title" aria-live="polite">Results</h2>
      <div class="search-results__content"></div>
    </div>
  </div>
</div>

              <button type="button" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></button>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading" data-module="collapsible-navigation">
                      <ul>
  <li>
    <a href="/#govuk-platform-as-a-service"><span>GOV.UK Platform as a Service</span></a>
  </li>
</ul>
<ul>
  <li>
    <a href="/before_you_start.html#before-you-start"><span>Before you start</span></a>
  </li>
</ul>
<ul>
  <li>
    <a href="/get_started.html#get-started"><span>Get started</span></a>
    <ul>
      <li>
        <a href="/get_started.html#get-an-account"><span>Get an account</span></a>
      </li>
      <li>
        <a href="/get_started.html#set-up-the-cloud-foundry-command-line"><span>Set up the Cloud Foundry command line</span></a>
      </li>
      <li>
        <a href="/get_started.html#sign-in-to-cloud-foundry"><span>Sign in to Cloud Foundry</span></a>
      </li>
      <li>
        <a href="/get_started.html#deploy-a-test-static-html-page"><span>Deploy a test static HTML page</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/responsibility_model.html#know-your-responsibilities"><span>Know your responsibilities</span></a>
    <ul>
      <li>
        <a href="/responsibility_model.html#standard-buildpack-responsibilities"><span>Standard buildpack responsibilities</span></a>
      </li>
      <li>
        <a href="/responsibility_model.html#custom-buildpack-responsibilities"><span>Custom buildpack responsibilities</span></a>
      </li>
      <li>
        <a href="/responsibility_model.html#docker-image-responsibilities"><span>Docker image responsibilities</span></a>
      </li>
      <li>
        <a href="/responsibility_model.html#custom-buildpacks-compared-to-docker-images"><span>Custom buildpacks compared to Docker images</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/orgs_spaces_users.html#managing-organisations-spaces-and-users"><span>Managing organisations, spaces and users</span></a>
    <ul>
      <li>
        <a href="/orgs_spaces_users.html#regions"><span>Regions</span></a>
      </li>
      <li>
        <a href="/orgs_spaces_users.html#organisations"><span>Organisations</span></a>
      </li>
      <li>
        <a href="/orgs_spaces_users.html#spaces"><span>Spaces</span></a>
      </li>
      <li>
        <a href="/orgs_spaces_users.html#users-and-user-roles"><span>Users and user roles</span></a>
      </li>
      <li>
        <a href="/orgs_spaces_users.html#manage-orgs-spaces-and-user-roles"><span>Manage orgs, spaces and user roles</span></a>
      </li>
      <li>
        <a href="/orgs_spaces_users.html#case-studies"><span>Case studies</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/deploying_apps.html#deploying-apps"><span>Deploying apps</span></a>
    <ul>
      <li>
        <a href="/deploying_apps.html#deploying-public-apps"><span>Deploying public apps</span></a>
      </li>
      <li>
        <a href="/deploying_apps.html#deploying-private-apps"><span>Deploying private apps</span></a>
      </li>
      <li>
        <a href="/deploying_apps.html#data-security-classification"><span>Data security classification</span></a>
      </li>
      <li>
        <a href="/deploying_apps.html#secure-and-non-secure-requests"><span>Secure and non-secure requests</span></a>
      </li>
      <li>
        <a href="/deploying_apps.html#deploy-an-app-to-production"><span>Deploy an app to production</span></a>
      </li>
      <li>
        <a href="/deploying_apps.html#buildpacks"><span>Buildpacks</span></a>
      </li>
      <li>
        <a href="/deploying_apps.html#excluding-files"><span>Excluding files</span></a>
      </li>
      <li>
        <a href="/deploying_apps.html#environment-variables"><span>Environment variables</span></a>
      </li>
      <li>
        <a href="/deploying_apps.html#names-routes-and-domains"><span>Names, routes and domains</span></a>
      </li>
      <li>
        <a href="/deploying_apps.html#deploy-a-static-html-page"><span>Deploy a static HTML page</span></a>
      </li>
      <li>
        <a href="/deploying_apps.html#deploy-a-ruby-on-rails-app"><span>Deploy a Ruby on Rails app</span></a>
      </li>
      <li>
        <a href="/deploying_apps.html#deploy-a-nodejs-app"><span>Deploy a Node.js app</span></a>
      </li>
      <li>
        <a href="/deploying_apps.html#deploy-a-django-app"><span>Deploy a Django app</span></a>
      </li>
      <li>
        <a href="/deploying_apps.html#deploy-a-java-app"><span>Deploy a Java app</span></a>
      </li>
      <li>
        <a href="/deploying_apps.html#deploy-a-net-core-app"><span>Deploy a .NET Core app</span></a>
      </li>
      <li>
        <a href="/deploying_apps.html#stopping-and-starting-apps"><span>Stopping and starting apps</span></a>
      </li>
      <li>
        <a href="/deploying_apps.html#deleting-apps"><span>Deleting apps</span></a>
      </li>
      <li>
        <a href="/deploying_apps.html#deploy-a-docker-image"><span>Deploy a Docker image</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/using_ci.html#configuring-a-continuous-integration-ci-tool"><span>Configuring a continuous integration (CI) tool</span></a>
    <ul>
      <li>
        <a href="/using_ci.html#choose-ci-tool"><span>Choose CI tool</span></a>
      </li>
      <li>
        <a href="/using_ci.html#configure-your-ci-tool-accounts"><span>Configure your CI tool accounts</span></a>
      </li>
      <li>
        <a href="/using_ci.html#using-the-travis-ci-tool"><span>Using the Travis CI tool</span></a>
      </li>
      <li>
        <a href="/using_ci.html#push-an-app-with-jenkins"><span>Push an app with Jenkins</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul><li><a href="/deploying_services/"><span>Deploy a backing or routing service</span></a>
<ul>
  <li>
    <a href="/deploying_services/postgresql/#postgresql"><span>PostgreSQL</span></a>
    <ul>
      <li>
        <a href="/deploying_services/postgresql/#set-up-the-service"><span>Set up the service</span></a>
      </li>
      <li>
        <a href="/deploying_services/postgresql/#amend-the-service"><span>Amend the service</span></a>
      </li>
      <li>
        <a href="/deploying_services/postgresql/#remove-the-service"><span>Remove the service</span></a>
      </li>
      <li>
        <a href="/deploying_services/postgresql/#maintaining-the-service"><span>Maintaining the service</span></a>
      </li>
      <li>
        <a href="/deploying_services/postgresql/#upgrading-major-versions-of-postgres"><span>Upgrading major versions of Postgres</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/deploying_services/mysql/#mysql"><span>MySQL</span></a>
    <ul>
      <li>
        <a href="/deploying_services/mysql/#set-up-the-service"><span>Set up the service</span></a>
      </li>
      <li>
        <a href="/deploying_services/mysql/#amend-the-service"><span>Amend the service</span></a>
      </li>
      <li>
        <a href="/deploying_services/mysql/#remove-the-service"><span>Remove the service</span></a>
      </li>
      <li>
        <a href="/deploying_services/mysql/#maintaining-the-service"><span>Maintaining the service</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/deploying_services/redis/#redis"><span>Redis</span></a>
    <ul>
      <li>
        <a href="/deploying_services/redis/#set-up-the-service"><span>Set up the service</span></a>
      </li>
      <li>
        <a href="/deploying_services/redis/#amend-the-service"><span>Amend the service</span></a>
      </li>
      <li>
        <a href="/deploying_services/redis/#remove-the-service"><span>Remove the service</span></a>
      </li>
      <li>
        <a href="/deploying_services/redis/#maintaining-the-service"><span>Maintaining the service</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/deploying_services/elasticsearch/#elasticsearch"><span>Elasticsearch</span></a>
    <ul>
      <li>
        <a href="/deploying_services/elasticsearch/#set-up-the-service"><span>Set up the service</span></a>
      </li>
      <li>
        <a href="/deploying_services/elasticsearch/#amend-the-service"><span>Amend the service</span></a>
      </li>
      <li>
        <a href="/deploying_services/elasticsearch/#remove-the-service"><span>Remove the service</span></a>
      </li>
      <li>
        <a href="/deploying_services/elasticsearch/#maintaining-the-service"><span>Maintaining the service</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/deploying_services/sqs/#amazon-sqs"><span>Amazon SQS</span></a>
    <ul>
      <li>
        <a href="/deploying_services/sqs/#set-up-the-service"><span>Set up the service</span></a>
      </li>
      <li>
        <a href="/deploying_services/sqs/#use-the-service"><span>Use the service</span></a>
      </li>
      <li>
        <a href="/deploying_services/sqs/#amend-the-service"><span>Amend the service</span></a>
      </li>
      <li>
        <a href="/deploying_services/sqs/#remove-the-service"><span>Remove the service</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/deploying_services/s3/#amazon-s3"><span>Amazon S3</span></a>
    <ul>
      <li>
        <a href="/deploying_services/s3/#set-up-the-service"><span>Set up the service</span></a>
      </li>
      <li>
        <a href="/deploying_services/s3/#use-the-service"><span>Use the service</span></a>
      </li>
      <li>
        <a href="/deploying_services/s3/#remove-the-service"><span>Remove the service</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/deploying_services/influxdb/#influxdb"><span>InfluxDB</span></a>
    <ul>
      <li>
        <a href="/deploying_services/influxdb/#set-up-the-service"><span>Set up the service</span></a>
      </li>
      <li>
        <a href="/deploying_services/influxdb/#use-the-service"><span>Use the service</span></a>
      </li>
      <li>
        <a href="/deploying_services/influxdb/#remove-the-service"><span>Remove the service</span></a>
      </li>
      <li>
        <a href="/deploying_services/influxdb/#maintaining-the-service"><span>Maintaining the service</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/deploying_services/user_provided_services/#user-provided-backing-services"><span>User-provided backing services</span></a>
  </li>
</ul>
<ul>
  <li>
    <a href="/deploying_services/route_services/#route-services"><span>Route services</span></a>
    <ul>
      <li>
        <a href="/deploying_services/route_services/#user-provided-route-services"><span>User-provided route services</span></a>
      </li>
      <li>
        <a href="/deploying_services/route_services/#implement-a-route-service"><span>Implement a route service</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/deploying_services/use_a_custom_domain/#managing-custom-domains-using-the-cdn-route-service"><span>Managing custom domains using the cdn-route service</span></a>
    <ul>
      <li>
        <a href="/deploying_services/use_a_custom_domain/#register-a-domain-name"><span>Register a domain name</span></a>
      </li>
      <li>
        <a href="/deploying_services/use_a_custom_domain/#using-your-domain-name-with-govuk-paas"><span>Using your domain name with GOV.UK PaaS</span></a>
      </li>
      <li>
        <a href="/deploying_services/use_a_custom_domain/#set-up-the-govuk-paas-cdn-route-service"><span>Set up the GOV.UK PaaS cdn-route service</span></a>
      </li>
      <li>
        <a href="/deploying_services/use_a_custom_domain/#amend-the-service"><span>Amend the service</span></a>
      </li>
      <li>
        <a href="/deploying_services/use_a_custom_domain/#configuring-your-custom-domain"><span>Configuring your custom domain</span></a>
      </li>
      <li>
        <a href="/deploying_services/use_a_custom_domain/#how-custom-domains-work"><span>How custom domains work</span></a>
      </li>
      <li>
        <a href="/deploying_services/use_a_custom_domain/#you-may-need-to-make-a-dns-change"><span>You may need to make a DNS change</span></a>
      </li>
      <li>
        <a href="/deploying_services/use_a_custom_domain/#making-changes-to-your-dns-records"><span>Making changes to your DNS records</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/deploying_services/configure_cdn/#set-up-a-custom-domain-by-configuring-your-own-cdn"><span>Set up a custom domain by configuring your own CDN</span></a>
    <ul>
      <li>
        <a href="/deploying_services/configure_cdn/#use-cloud-foundry-commands"><span>Use Cloud Foundry commands</span></a>
      </li>
      <li>
        <a href="/deploying_services/configure_cdn/#amend-http-request-headers"><span>Amend HTTP request headers</span></a>
      </li>
    </ul>
  </li>
</ul>
</li></ul><ul>
  <li>
    <a href="/managing_apps.html#managing-apps"><span>Managing apps</span></a>
    <ul>
      <li>
        <a href="/managing_apps.html#connecting-with-ssh"><span>Connecting with SSH</span></a>
      </li>
      <li>
        <a href="/managing_apps.html#managing-ssh-permissions"><span>Managing SSH permissions</span></a>
      </li>
      <li>
        <a href="/managing_apps.html#scaling"><span>Scaling</span></a>
      </li>
      <li>
        <a href="/managing_apps.html#autoscaling"><span>Autoscaling</span></a>
      </li>
      <li>
        <a href="/managing_apps.html#quotas"><span>Quotas</span></a>
      </li>
      <li>
        <a href="/managing_apps.html#redirecting-all-traffic"><span>Redirecting all traffic</span></a>
      </li>
      <li>
        <a href="/managing_apps.html#app-restarts"><span>App restarts</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/monitoring_apps.html#monitoring-apps"><span>Monitoring apps</span></a>
    <ul>
      <li>
        <a href="/monitoring_apps.html#app-metrics"><span>App metrics</span></a>
      </li>
      <li>
        <a href="/monitoring_apps.html#more-about-monitoring"><span>More about monitoring</span></a>
      </li>
      <li>
        <a href="/monitoring_apps.html#logs"><span>Logs</span></a>
      </li>
      <li>
        <a href="/monitoring_apps.html#set-up-the-logit-log-management-service"><span>Set up the Logit log management service</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/monitoring_services.html#monitoring-backing-services"><span>Monitoring backing services</span></a>
    <ul>
      <li>
        <a href="/monitoring_services.html#view-backing-service-metrics"><span>View backing service metrics</span></a>
      </li>
      <li>
        <a href="/monitoring_services.html#exporting-backing-service-metrics-to-prometheus"><span>Exporting backing service metrics to Prometheus</span></a>
      </li>
      <li>
        <a href="/monitoring_services.html#backing-service-logs"><span>Backing service logs</span></a>
      </li>
      <li>
        <a href="/monitoring_services.html#more-about-monitoring"><span>More about monitoring</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/architecture.html#govuk-paas-architecture"><span>GOV.UK PaaS Architecture</span></a>
    <ul>
      <li>
        <a href="/architecture.html#characteristics-of-govuk-paas"><span>Characteristics of GOV.UK PaaS</span></a>
      </li>
      <li>
        <a href="/architecture.html#12-factor-application-principles"><span>12-factor application principles</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/guidance.html#guidance"><span>Guidance</span></a>
    <ul>
      <li>
        <a href="/guidance.html#penetration-testing"><span>Penetration testing</span></a>
      </li>
      <li>
        <a href="/guidance.html#connect-a-php-app-to-postgresql-or-mysql"><span>Connect a PHP app to PostgreSQL or MySQL</span></a>
      </li>
      <li>
        <a href="/guidance.html#connect-drupal-to-mysql"><span>Connect Drupal to MySQL</span></a>
      </li>
      <li>
        <a href="/guidance.html#connect-wordpress-to-mysql"><span>Connect Wordpress to MySQL</span></a>
      </li>
      <li>
        <a href="/guidance.html#isolation-segments"><span>Isolation segments</span></a>
      </li>
      <li>
        <a href="/guidance.html#useful-plugins"><span>Useful Plugins</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/troubleshooting.html#troubleshooting"><span>Troubleshooting</span></a>
    <ul>
      <li>
        <a href="/troubleshooting.html#postgresql-connection-problems"><span>PostgreSQL connection problems</span></a>
      </li>
      <li>
        <a href="/troubleshooting.html#pushing-apps-fails-on-windows-line-endings-issue"><span>Pushing apps fails on Windows (line endings issue)</span></a>
      </li>
      <li>
        <a href="/troubleshooting.html#tracing-http-requests"><span>Tracing HTTP requests</span></a>
      </li>
      <li>
        <a href="/troubleshooting.html#forgotten-passwords"><span>Forgotten passwords</span></a>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
            <h1 id="route-services">Route services</h1>

<p>Tenants may wish to apply some processing to requests before they reach an application. Common examples of use cases are authentication, rate limiting, and caching services.</p>

<p>If you need to run a private app that can only be accessed by other apps in the same space, you should refer to the documentation on <a href="/deploying_apps.html#deploying-private-apps">private apps</a>.</p>

<p>Cloud Foundry allows the tenants to bind <a href="/deploying_apps.html#names-routes-and-domains">application routes</a> to <a href="https://docs.cloudfoundry.org/services/route-services.html">route services</a>. A route service acts as a full proxy. Once it is bound to a route, the platform routing layer will send every request for that route to the route service endpoint. The route service can then process the incoming request, proxy it back to the original application, and finally process the response request before returning it to the original client.</p>

<p>Using route services has some consequences to be aware of:</p>

<ul>
  <li><p>Every request will include additional latency as it will be proxied through the Routing Service.</p>
  </li>
  <li><p>The route service will be able to access all the request content in clear.</p>
  </li>
  <li><p>The route service would become a critical point of failure, and if it is not available, the application will not be available for the end users.</p>
  </li>
</ul>

<h2 id="user-provided-route-services">User-provided route services</h2>

<p>Tenants can define their own route service instance by using a <a href="https://docs.cloudfoundry.org/devguide/services/user-provided.html">user-provided service instance</a> that points to any HTTPS service. This endpoint must fulfill the following requirements:</p>

<ul>
  <li><p>It must be a HTTPS endpoint with a valid certificate.</p>
  </li>
  <li><p>It can be a application running in the platform itself or an external service on the Internet.</p>
  </li>
  <li><p>It must be reachable from the platform (ie. not blocked by a firewall or in a private network).</p>
  </li>
  <li><p>It must implement the <a href="/deploying_services/route_services/#implement-a-route-service">route service protocol</a></p>
  </li>
</ul>

<p>This is how you define an user-provided route service instance and map it to the route of your app:</p>

<ol>
  <li>
<p>From the command line, run:</p>

<div class="highlight"><pre class="highlight plaintext"><code> cf create-user-provided-service SERVICE_INSTANCE -r ROUTE_SERVICE_URL
</code></pre></div>
<p>where <code>SERVICE_INSTANCE</code> is a unique, descriptive name for this route service instance, and <code>ROUTE_SERVICE_URL</code> is the url of the route service endpoint; for example:</p>

<div class="highlight"><pre class="highlight plaintext"><code> cf create-user-provided-service my-route-service -r https://route-service.example.org
</code></pre></div>
<p>The service will be immediately ready to be used, and you can query its status by running:</p>

<div class="highlight"><pre class="highlight plaintext"><code> cf service my-route-service
</code></pre></div>  </li>
  <li>
<p>Bind this route service instance to the <a href="/deploying_apps.html#names-routes-and-domains">application route</a></p>

<div class="highlight"><pre class="highlight plaintext"><code> cf bind-route-service DOMAIN SERVICE_INSTANCE --hostname HOSTNAME
</code></pre></div>
<p>where:</p>
    <ul>
      <li><p><code>DOMAIN</code> is your app domain, and varies depending on which <a href="/orgs_spaces_users.html#regions">region</a> your app is hosted in</p>
      </li>
      <li><p><code>SERVICE_INSTANCE</code> the name of the service that you have just created</p>
      </li>
      <li><p><code>HOSTNAME</code> the host or app name assigned to the app</p>
      </li>
    </ul>

<p>For example, if your app is named <code>myapp</code> and is hosted in the London region:</p>

<div class="highlight"><pre class="highlight plaintext"><code> cf bind-route-service london.cloudapps.digital my-route-service --hostname myapp
</code></pre></div>  </li>
  <li>
<p>You can list the <a href="/deploying_apps.html#names-routes-and-domains">routes</a> of the current <a href="/orgs_spaces_users.html#spaces">space</a> to see the applications and route services bound to them:</p>

<div class="highlight"><pre class="highlight plaintext"><code> cf routes
</code></pre></div>
<p>If the route service endpoint is not responding correctly, you might get the following response when querying the route:</p>

<p><code>502 Bad Gateway: Registered endpoint failed to handle the request.</code></p>

<p>If you get this error, double check that the endpoint is working and reachable from the platform, that it is using a valid SSL certificate, that responds timely and that it implements the <a href="/deploying_services/route_services/#implement-a-route-service">route service protocol</a>.</p>
  </li>
</ol>

<h2 id="implement-a-route-service">Implement a route service</h2>

<p>A route service can be implemented as a HTTPS application that will receive all requests for the associated route from the Cloud Foundry router. The request will contain the following additional headers:</p>

<ul>
  <li><p><code>X-CF-Forwarded-Url</code> header contains the URL of the application route. The route service should forward the request to this URL.</p>
  </li>
  <li><p><code>X-CF-Proxy-Signature</code> and <code>X-CF-Proxy-Metadata</code>: Signature and metadata used by the platform route itself to validate the request sent by the route service.<br />
The route service must always include these headers.</p>
  </li>
</ul>

<p>The route service must proxy back the request to the application route defined in header <code>X-CF-Forwarded-Url</code> within 60 seconds, otherwise the request will be refused. In addition, the total time to process the request and send a response back must be within 900 seconds.</p>

<p><a href="/images/route-service.svg" rel="noopener noreferrer"><img src="/images/route-service.svg" alt="Route service request life cycle" /></a></p>

<p>You can refer to the <a href="https://docs.cloudfoundry.org/services/route-services.html">Cloud Foundry documentation on route services</a> for more information.</p>

<h3 id="example-route-service-to-add-username-and-password-authentication">Example: Route service to add username and password authentication</h3>

<p>In the following example we will add a route service to provide basic HTTP authentication to the bound routes. This can be used to restrict access to a beta application.</p>

<p>An example of such a route service application code can be found in the <a href="https://github.com/alphagov/paas-cf_basic_auth_route_service">Cloud Foundry basic auth route service</a>.<br />
Please note this is a proof-of-concept and is not intended to run in production.</p>

<p>We will deploy it as an app in the platform itself. Then we will bind this route service to an app named <code>myapp</code>, deployed in the London region and therefore accessible at https://myapp.london.cloudapps.digital.</p>

<ol>
  <li>
<p>Deploy the route service as <a href="/deploying_apps.html#deploying-apps">any other other application</a>.<br />
Do not start it yet, as we need to configure it first.</p>

<div class="highlight"><pre class="highlight plaintext"><code> git clone https://github.com/alphagov/paas-cf_basic_auth_route_service
 cd paas-cf_basic_auth_route_service
 cf push my-basic-auth-service-app --no-start
</code></pre></div>
<p>Note: You might want to change <code>my-basic-auth-service-app</code> with a different name to avoid conflicts with other tenants' apps.</p>
  </li>
  <li>
<p>This example route service can only authenticate one user with fixed username and password. Choose any value for username and password then pass them to the application using environment variables <code>AUTH_USERNAME</code> and <code>AUTH_PASSWORD</code>. Finally the route service can be started:</p>

<div class="highlight"><pre class="highlight plaintext"><code> cf set-env my-basic-auth-service-app AUTH_USERNAME myuser
 cf set-env my-basic-auth-service-app AUTH_PASSWORD pass1234
 cf start my-basic-auth-service-app
</code></pre></div>
<p>The new service is serving in https://my-basic-auth-service-app.london.cloudapps.digital.</p>
  </li>
  <li>
<p>Register the route service endpoint as an user-provided service instance:</p>

<div class="highlight"><pre class="highlight plaintext"><code> cf create-user-provided-service my-basic-auth-service -r https://my-basic-auth-service-app.london.cloudapps.digital
</code></pre></div>  </li>
  <li>
<p>Finally, bind the route service to the application route:</p>

<div class="highlight"><pre class="highlight plaintext"><code> cf bind-route-service london.cloudapps.digital my-basic-auth-service --hostname myapp
</code></pre></div>
<p>The application in https://myapp.london.cloudapps.digital will now ask for basic HTTP authentication, with login <code>myuser</code> and password <code>pass1234</code>.</p>
  </li>
</ol>

<h3 id="example-route-service-to-add-ip-address-authentication">Example: Route service to add IP address authentication</h3>

<p>GDS maintains an <a href="https://github.com/alphagov/paas-ip-authentication-route-service">example nginx app</a> which you can use as a route service to add IP address authentication.<br />
This ensures that only HTTP requests originating from a trusted set of IP addresses can access your app.</p>

<p>This example app uses the <code>X-Forwarded-For</code> header added by the GOV.UK PaaS routers to HTTP requests originating from outside the platform.</p>

<p>Using an IP address to authenticate HTTP requests is not sufficient as a standalone authentication mechanism.<br />
You should use other authentication and authorization methods in your apps.</p>

<h4 id="using-the-x-forwarded-for-header">Using the <code>X-Forwarded-For</code> header</h4>

<p>The <code>X-Forwarded-For</code> header is useful for working out the source IP address of the originating HTTP request, and can be used for authentication, or analytics.</p>

<p>The GOV.UK PaaS routers set headers in the following format: <code>X-Forwarded-For: SOURCE-IP-ADDRESSES, ROUTER-INTERNAL-IP-ADDRESS</code>, where:</p>

<ul>
  <li><p><code>SOURCE-IP-ADDRESSES</code> are the source IP addresses of the original request</p>
  </li>
  <li><p><code>ROUTER-INTERNAL-IP-ADDRESS</code> is the internal IP address of the router handling the request</p>
  </li>
</ul>

<p>For example: <code>X-Forwarded-For: 208.80.152.201, 10.0.0.49</code></p>

<p>If you are using the <code>X-Forwarded-For</code> header for IP address authentication, then you should trust the CIDR range <code>10.0.0.0/8</code> to set the <code>X-Forwarded-For</code> header.</p>

<h4 id="proxied-requests">Proxied requests</h4>

<p>If the <code>X-Forwarded-For</code> header is already set when the router receives the request, then the router appends the source IP address of the request and router's IP address to the header.</p>

<p>For example:</p>

<ul>
  <li><p>an HTTP request sent from <code>208.80.152.201</code> to the router has the header <code>X-Forwarded-For: 1.2.3.4</code></p>
  </li>
  <li><p>the router loopback IP address is <code>127.0.0.1</code></p>
  </li>
  <li><p>the router internal IP address is <code>10.0.0.49</code></p>
  </li>
</ul>

<p>The <code>X-Forwarded-For</code> header presented to your app will be: <code>X-Forwarded-For: 1.2.3.4, 208.80.152.201, 10.0.0.49</code></p>


            
          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/alphagov/paas-tech-docs//blob/master/source/deploying_services/route_services/index.html.md.erb">View source</a></li>
                <li><a href="mailto:gov-uk-paas-support@digital.cabinet-office.gov.uk?subject=Problem%20with%20GOV.UK%20PaaS%20technical%20documentation">Report problem</a></li>
                <li><a href="https://github.com/alphagov/paas-tech-docs/">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">

        <ul class="govuk-footer__inline-list">
            <li class="govuk-footer__inline-list-item">
              <a class="govuk-footer__link" href="/accessibility.html">Technical Documentation Accessibility</a>
            </li>
        </ul>

      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="/javascripts/application.js"></script>
  </body>
</html>
