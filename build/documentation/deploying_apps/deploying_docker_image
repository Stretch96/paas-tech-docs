<h2 id="deploy-a-docker-image">Deploy a Docker image</h2>

<p>This section explains how to deploy an app from a Docker image. The role of the Docker image is to serve as a packaging format and the requirements for the app and its runtime environment are the same as for apps deployed using buildpacks. Configuration using manifest.yml also stays the same, albeit you should not specify buildpack. If you do, it will be ignored, which can create some confusion to anyone reading the manifest. Our platform currently supports deploying from the following:</p>

<ul>
  <li><p>Docker Hub</p>
  </li>
  <li><p><a href="https://docs.docker.com/datacenter/dtr/2.1/guides/">Docker Trusted Registry</a> [external page] servers</p>
  </li>
  <li><p>Docker registries that require authentication</p>
  </li>
</ul>

<p>Pushing local Docker images is not supported.</p>

<p>To deploy an app using a Docker image stored in Docker Hub using CF cli:</p>

<p><code>cf push myapp --docker-image dockerhuborg/app_image:tag</code></p>

<p>To deploy an app using a Docker image stored in Docker Trusted Registry (DTR) using CF cli:</p>

<p><code>cf push myapp --docker-image MY-PRIVATE-REGISTRY.DOMAIN:5000/image/name:tag</code></p>

<p>To deploy an app using a Docker image stored in a registry that requires authentication, follow the <a href="https://docs.cloudfoundry.org/devguide/deploy-apps/push-docker.html#private-repo">Cloud Foundry Docker image documentation instructions</a>.</p>

<p>You might notice that the staging process is simplified when deploying from a Docker image - this is because there is no need to build the app from the pushed code using a buildpack. Also, the buildpack for apps deployed from a Docker image will be reported as <code>unknown</code> in the app information (<code>cf app &lt;myapp&gt;</code>).</p>

<p>There are a few more specifics about Docker image support in Cloud Foundry:</p>

<ul>
  <li><p>Local storage in each container instance is ephemeral. Every container launch will start with unmodified image.</p>
  </li>
  <li><p>Traffic will be routed to the lowest exposed port (by <code>EXPOSE</code> command in Dockerfile). The PORT environment variable will be also set to this number.</p>
  </li>
  <li><p>Buildpack based apps use bash to execute the app start command (<code>bash -c &lt;command&gt;</code>), but Docker image based apps use sh (<code>sh -c &lt;command&gt;</code>) - as bash presence cannot be assumed in your Docker image.</p>
  </li>
  <li><p>Privileged container mode is not supported. Features depending on this will not work.</p>
  </li>
  <li><p>Only registries that use Docker Registry API V2 are supported.</p>
  </li>
  <li><p>Images are cached based on tag. Using a tag like <code>latest</code> when doing quick iterations can result in errors. To prevent this, tags should be unique. For example, the time the image was created, or a git commit hash.</p>
  </li>
</ul>

<p>Your responsibilities change if you use a Docker image instead of a buildpack. Refer to the <a href="/guidance.html#responsibility-model">responsibility model guidance</a> for further information.</p>

<h3 id="docker-registry-availability-requirements">Docker Registry Availability Requirements</h3>

<p>Deploying, scaling, restarting or restaging an app using a Docker image are all dependent on the Docker registry being available, because these actions require pulling the image from the registry.</p>

<p>Note that Cloud Foundry can restart your application due to circumstances outside of your direct control, such as platform scaling or deployments, or failure of the underlying hardware platform.</p>

<p>If Cloud Foundry attempts to pull the image from the registry when the registry is not available, your application instance will fail to start, and you will receive a <code>Failed to create container</code> message. Once the Docker registry is available again, you will be able to re-deploy, restart or restage your app as required.</p>

<h3 id="applying-security-updates">Applying security updates</h3>

<p>When your app is built with a standard buildpack, you are responsible only for the code of your app. The platform provides both the buildpacks and also a safe and secure root filesystem (<code>cflinuxfs3</code>). Buildpack based apps never have root access in their container, which adds another layer of security. We do periodically apply security and functionality updates to the buildpacks, container root FS and the platform itself.</p>

<p>When your app is deployed from Docker image, responsibility for the root filesystem and for the complete build of your app shifts to you. You need to ensure proper measures are applied to make your app and root image safe and with the latest security updates. We recommend you use one of the major and well supported linux distributions as your base container. This way you will be able to build an image with latest security patches.</p>
